"0","source(""preprocessing_functions.R"")"
"0","library(mice)"
"0","library(pROC)"
"0","library(psfmi)"
"0","# Calculate AUCs, sens, spec on training set"
"0","outcomes <- c(""hosp_1_year"", "
"0","              ""hosp_3_year"","
"0","              ""hosp_5_year"","
"0","              ""mort_1_year"","
"0","              ""mort_3_year"","
"0","              ""mort_5_year"")"
"0","nimp <- 100"
"0","preds <- rownames(coef.df)[-1]"
"0","  "
"0","# AUC, Sens, and Spec contain mean and 95% CI after pooling using Rubin's"
"0","auc_pooled.female <- as.numeric(list())"
"0","sens_pooled.female <- as.numeric(list())"
"0","spec_pooled.female <- as.numeric(list())"
"0",""
"0","auc_pooled.male <- as.numeric(list())"
"0","sens_pooled.male <- as.numeric(list())"
"0","spec_pooled.male <- as.numeric(list())"
"0",""
"0","# outcome <- ""hosp_1_year"""
"0","# load coefficients"
"0","load(""results/coefs.Rda"")"
"2","Error in exists(cacheKey, where = .rs.WorkingDataEnv, inherits = FALSE) : 
  invalid first argument
"
"2","Error in assign(cacheKey, frame, .rs.CachedDataEnv) : 
  attempt to use zero-length variable name
"
"0","# Loop through every outcome"
"0","for (outcome in outcomes) {"
"0","  print(outcome)"
"0","  start.time <- Sys.time()"
"0","  print(start.time)"
"0","  # load imputed database"
"0","  load(paste(""data"", outcome, ""train_imp_100.Rda"", sep=""/""))"
"0","  load(paste(""data"", outcome, ""test_imp_100.Rda"", sep=""/""))"
"0",""
"0","  # Get imputed datasets into dfs list"
"0","  dfs <- lapply(1:nimp, "
"0","                  function(i) prepare_categ_vars("
"0","                    complete(train_imp, action=i), "
"0","                    outcome)"
"0","                  )"
"0","  # Female lists"
"0","  x.female <- list()"
"0","  y.female <- list()"
"0","  preds.female <- list()"
"0","  coef.female <- coef.df %>%"
"0","    select(paste(outcome, ""female"", sep=""."")) %>%"
"0","    as.matrix()"
"0","  roc.female <- list()"
"0","  "
"0","  # Male lists"
"0","  x.male <- list()"
"0","  y.male <- list()"
"0","  preds.male <- list()"
"0","  coef.male <- coef.df %>% "
"0","    select(paste(outcome, ""male"", sep=""."")) %>%"
"0","    as.matrix()"
"0","  roc.male <- list()"
"0",""
"0","  # Generate list of design matrices and imputed responses"
"0","  i <- 1"
"0","  for (i in 1:nimp) {"
"0","    x.female[[i]] <-"
"0","      as.matrix(dfs[[i]][dfs[[i]][,""sex""]==0, preds])"
"0","    x.male[[i]] <-"
"0","      as.matrix(dfs[[i]][dfs[[i]][,""sex""]==1, preds])"
"0","    y.female[[i]] <- dfs[[i]][dfs[[i]][,""sex""]==0, ""outcome""]"
"0","    y.male[[i]] <- dfs[[i]][dfs[[i]][,""sex""]==1, ""outcome""]"
"0","    "
"0","    # Calculate preds"
"0","    preds.female[[i]] <- cbind(1, x.female[[i]]) %*% coef.female"
"0","    preds.male[[i]] <- cbind(1, x.male[[i]]) %*% coef.male"
"0","  }"
"0","  "
"0","  # Create ROC objects"
"0","  roc_list.female <- create_roc_list(y.female, preds.female)"
"0","  roc_list.male <- create_roc_list(y.male, preds.male)"
"0","  "
"0","  # Calculate AUC, Sens, and Spec mean and standard errors for each imp"
"0","  auc_df.female <- calculate_auc_df(roc_list.female)"
"0","  auc_df.male <- calculate_auc_df(roc_list.male)"
"0","  sens_spec_df.female <- calculate_sens_spec_df(roc_list.female)"
"0","  sens_spec_df.male <- calculate_sens_spec_df(roc_list.male)"
"0","  "
"0","  "
"0","  # Calculate AUC, Sens, Spec and pool using Rubin's rules"
"0","  ## Female"
"0","  auc_pooled.female <- rbind(auc_pooled.female,"
"0","                             pool_auc(auc_df.female$auc_mean, "
"0","                                      auc_df.female$auc_se, "
"0","                                      nimp=nimp))"
"0","  sens_pooled.female <- rbind(sens_pooled.female,"
"0","                              pool_auc(sens_spec_df.female$sens_mean,"
"0","                                       sens_spec_df.female$sens_se,"
"0","                                       nimp=nimp))"
"0","  spec_pooled.female <- rbind(spec_pooled.female,"
"0","                              pool_auc(sens_spec_df.female$spec_mean,"
"0","                                       sens_spec_df.female$spec_se,"
"0","                                       nimp=nimp))"
"0","  ## Male"
"0","  auc_pooled.male <- rbind(auc_pooled.male, "
"0","                           pool_auc(auc_df.male$auc_mean, "
"0","                                    auc_df.male$auc_se, "
"0","                                    nimp=nimp))"
"0","  sens_pooled.male <- rbind(sens_pooled.male,"
"0","                              pool_auc(sens_spec_df.male$sens_mean,"
"0","                                       sens_spec_df.male$sens_se,"
"0","                                       nimp=nimp))"
"0","  spec_pooled.male <- rbind(spec_pooled.male,"
"0","                              pool_auc(sens_spec_df.male$spec_mean,"
"0","                                       sens_spec_df.male$spec_se,"
"0","                                       nimp=nimp))"
"0","  end.time <- Sys.time()"
"0","  print(end.time-start.time)"
"0","}"
"1","[1]"
"1"," ""hosp_1_year"""
"1","
"
"1","[1]"
"1"," ""2024-05-26 04:12:24 ACST"""
"1","
"
"1","Time difference of "
"1",""
"1","6.546946"
"1",""
"1"," "
"1",""
"1","mins"
"1",""
"1","
"
"1","[1]"
"1"," ""hosp_3_year"""
"1","
"
"1","[1]"
"1"," ""2024-05-26 04:18:57 ACST"""
"1","
"
"1","Time difference of "
"1",""
"1","5.586708"
"1",""
"1"," "
"1",""
"1","mins"
"1",""
"1","
"
"1","[1]"
"1"," ""hosp_5_year"""
"1","
"
"1","[1]"
"1"," ""2024-05-26 04:24:32 ACST"""
"1","
"
"1","Time difference of "
"1",""
"1","4.378432"
"1",""
"1"," "
"1",""
"1","mins"
"1",""
"1","
"
"1","[1]"
"1"," ""mort_1_year"""
"1","
"
"1","[1]"
"1"," ""2024-05-26 04:28:55 ACST"""
"1","
"
"1","Time difference of "
"1",""
"1","6.781695"
"1",""
"1"," "
"1",""
"1","mins"
"1",""
"1","
"
"1","[1]"
"1"," ""mort_3_year"""
"1","
"
"1","[1]"
"1"," ""2024-05-26 04:35:42 ACST"""
"1","
"
"1","Time difference of "
"1",""
"1","5.583164"
"1",""
"1"," "
"1",""
"1","mins"
"1",""
"1","
"
"1","[1]"
"1"," ""mort_5_year"""
"1","
"
"1","[1]"
"1"," ""2024-05-26 04:41:17 ACST"""
"1","
"
"1","Time difference of "
"1",""
"1","4.397128"
"1",""
"1"," "
"1",""
"1","mins"
"1",""
"1","
"
"0","auc_pooled.female <- as.data.frame(auc_pooled.female)"
"0","rownames(auc_pooled.female) <- outcomes"
"0","sens_pooled.female <- as.data.frame(sens_pooled.female)"
"0","rownames(sens_pooled.female) <- outcomes"
"0","spec_pooled.female <- as.data.frame(spec_pooled.female)"
"0","rownames(spec_pooled.female) <- outcomes"
"0",""
"0",""
"0","auc_pooled.male <- as.data.frame(auc_pooled.male)"
"0","rownames(auc_pooled.male) <- outcomes"
"0","sens_pooled.male <- as.data.frame(sens_pooled.male)"
"0","rownames(sens_pooled.male) <- outcomes"
"0","spec_pooled.male <- as.data.frame(spec_pooled.male)"
"0","rownames(spec_pooled.male) <- outcomes"
"0",""
