"0",""
"0",""
"0","group_smoking_status <- function(df) {"
"0","  df <- df %>% "
"0","    mutate(smoking_status.Ex = smoking_status.X1,"
"0","           smoking_status.Current = smoking_status.X1 + smoking_status.X2) %>%"
"0","    select(-smoking_status.X1, -smoking_status.X2)"
"0","  return(df)"
"0","}"
"0",""
"0","group_mmrc <- function(df) {"
"0","  df <- df %>%"
"0","    mutate(mmrc.1 = mmrc.X1,"
"0","           mmrc.2 = mmrc.X1 + mmrc.X2,"
"0","           mmrc.3 = mmrc.X1 + mmrc.X2 + mmrc.X3,"
"0","           mmrc.4 = mmrc.X1 + mmrc.X2 + mmrc.X3 + mmrc.X4) %>%"
"0","    select(-mmrc.X1, -mmrc.X2, -mmrc.X3, -mmrc.X4)"
"0","}"
"0",""
"0","format_var <- function(str_var) {"
"0","  if(str_var==""smoking_status"") {"
"0","    title <- ""Coefficient Paths (Smoking Status)"""
"0","    legend.name <- ""Smoking Status"""
"0","    legend.breaks <- c(""smoking_status.Ex"", ""smoking_status.Current"")"
"0","    legend.labels <- c(""Smoking Status=Ex"", ""Smoking Status=Current"")"
"0","  }"
"0","  else if(str_var==""mmrc"") {"
"0","    title <- ""Coefficient Paths (mMRC)"""
"0","    legend.name = ""mMRC"""
"0","    legend.breaks <- c(""mmrc.1"", ""mmrc.2"", ""mmrc.3"", ""mmrc.4"")"
"0","    legend.labels <- c(""mMRC=1"", ""mMRC=2"", ""mMRC=3"", ""mMRC=4"")"
"0","  }"
"0","  return(list(title=title, "
"0","              legend.breaks=legend.breaks, "
"0","              legend.labels=legend.labels))"
"0","}"
"0",""
"0","plot_categ_coef_paths <- function(fit, alpha=1) {"
"0","  lambdas <- fit$lambda"
"0","  coef_list <- list()"
"0","  for(i in 1:length(lambdas)) {"
"0","    lambda= lambdas[i]"
"0","    coef_list[[i]] <- coef(fit, lambda=lambda, alpha=alpha)"
"0","  }"
"0","  coefs.df <- data.frame(do.call(rbind, coef_list))"
"0","  coefs.df[""lambda""] <- lambdas # Append lambdas column for plotting"
"0","  categ_coefs <- coefs.df %>% "
"0","    group_smoking_status() %>%"
"0","    group_mmrc() %>%"
"0","    select("
"0","      lambda, "
"0","      mmrc.1, mmrc.2, mmrc.3, mmrc.4, "
"0","      smoking_status.Ex, smoking_status.Current"
"0","      ) %>%"
"0","    gather(""level"", ""coef"", 2:7)  %>% # Gather so we can group across variables"
"0","    mutate(variable = str_remove(level, ""\\..*$""))"
"0","  "
"0","  "
"0","  # Plot the coefs, gathered and colored by variable."
"0","  out <- by("
"0","    data = categ_coefs, "
"0","    INDICES = categ_coefs$variable,"
"0","    FUN = function(m) {"
"0","      m <- droplevels(m)"
"0","      formats <- format_var(m[1,'variable'])"
"0","      m <- ggplot(m) +"
"0","        geom_line(aes(x=-log(lambda), y=coef, group=level, color=level)) +"
"0","        # facet_wrap(vars(variable), scales=""free_y"") + "
"0","        theme_minimal() +"
"0","        labs(x=""-log(lambda)"","
"0","             y=""Coefficient"","
"0","             title=formats$title) +"
"0","        scale_colour_discrete(name=formats$legend.name,"
"0","                             breaks=formats$legend.breaks,"
"0","                             labels=formats$legend.labels)+"
"0","        theme(legend.position = ""right"")"
"0","      }"
"0","    )"
"0","  plt <- do.call(grid.arrange, out)"
"0","  return(plt)"
"0","}"
"0",""
"0","plt<-plot_categ_coef_paths(fit.male, alpha=1)"
